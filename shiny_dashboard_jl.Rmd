---
title: "US Frequency Map"
output: 
  flexdashboard::flex_dashboard:
    orientation: column
    vertical_layout: fill 
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(viridis)
library(leaflet)
```

```{r import, include=FALSE}
# data import and cleaning
ufo_data = read_csv("./data/tidied_data_final.csv", na = "")

ufo =
  ufo_data %>%  
#  separate(date_time, into = c("date","time"), sep = " " ) %>%
  separate(date, into = c("month","day","year"), sep = "/") %>% 
  mutate(a = longitude, longitude = latitude, latitude = a) %>% 
  filter(country == "USA") %>% 
  select(latitude, longitude, state, city) %>% 
  group_by(latitude, longitude, state, city) %>% 
  summarize(n = n())
```

Column {.sidebar}
-----------------------------------------------------------------------

```{r sidebar, echo=FALSE}
# set the max and min frequency for range
min_frequency = 1
max_frequency = 600
# sliderInput widget
sliderInput(
  "frequency_range", 
  label = h3("Choose frequency range"), 
  min = min_frequency, max = max_frequency, value = c(25, 300))

# set choice list for focus points
min_focus = 100
max_focus = 300
# sliderInput widget
sliderInput(
  "focus_choice", 
  label = h3("Choose focus point minimum value"), 
  min = min_focus, max = max_focus, value = 300)
```

Column 
-----------------------------------------------------------------------

### US Frequency Map

```{r chartA, echo=FALSE}
renderLeaflet({
  ufo %>% 
    filter(n %in% input$frequency_range[1]:input$frequency_range[2]) %>% 
    leaflet() %>% 
    addTiles() %>% 
    addCircleMarkers(
      radius = ~n/100,
      color = ~ifelse(n > input$focus_choice, "red", "navy"),
      ~latitude,
      ~longitude,
      label = ~paste0(city, " ", state, ", ", n, " times seen UFO")
    )
})
```


